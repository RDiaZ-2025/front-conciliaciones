<div class="layout-wrapper min-h-screen flex flex-column surface-ground">
   <!-- Topbar -->
   <p-toolbar styleClass="fixed top-0 left-0 right-0 z-5 border-none shadow-2 px-4 py-2" [style]="{'height': '4rem'}">
      <div class="p-toolbar-group-start gap-2">
         <p-button icon="pi pi-bars" [text]="true" [rounded]="true" (click)="toggleDrawer()"
            styleClass="text-900 w-3rem h-3rem"></p-button>
         <img src="assets/Claro-Media-Logo.jpg" alt="Logo" class="h-2rem ml-2">
      </div>
      <div class="p-toolbar-group-end gap-2">
         <p-button [icon]="isDarkMode() ? 'pi pi-sun' : 'pi pi-moon'" [text]="true" [rounded]="true"
            (click)="toggleTheme()" styleClass="text-900 w-3rem h-3rem"></p-button>
      </div>
   </p-toolbar>

   <!-- Sidebar / Drawer -->
   <p-drawer [visible]="isDrawerOpen" (visibleChange)="onDrawerVisibleChange($event)" [modal]="true"
      [showCloseIcon]="true" styleClass="w-20rem shadow-6">
      <ng-template pTemplate="header">
         <div class="flex align-items-center gap-2">
            <img src="assets/Claro-Media-Logo.jpg" alt="Logo" class="h-2rem">
            <span class="font-bold text-xl text-900">Menú</span>
         </div>
      </ng-template>

      <div class="flex flex-column h-full">
         <div *ngIf="loading()" class="flex justify-content-center p-4">
            <i class="pi pi-spin pi-spinner text-2xl text-primary"></i>
         </div>

         <div *ngIf="error()" class="p-4 text-red-500 text-center">
            {{ error() }}
         </div>

         <ul class="list-none p-0 m-0 flex-grow-1 overflow-y-auto" *ngIf="!loading() && !error()">
            <ng-container *ngFor="let item of menuItems()">
               <ng-container *ngIf="hasPermission(item)">

                  <!-- Item with children -->
                  <li *ngIf="item.children && item.children.length > 0" class="mb-1">
                     <div pRipple
                        class="p-3 flex align-items-center justify-content-between text-700 cursor-pointer border-round hover:surface-100 transition-duration-150 transition-colors w-full"
                        pStyleClass="@next" enterClass="hidden" enterActiveClass="slidedown" leaveToClass="hidden"
                        leaveActiveClass="slideup">
                        <span class="flex align-items-center gap-3">
                           <i [class]="getIconName(item.icon) + ' text-lg'"></i>
                           <span class="font-medium">{{ item.label }}</span>
                        </span>
                        <i class="pi pi-chevron-down text-sm"></i>
                     </div>
                     <ul
                        class="list-none py-0 pl-3 pr-0 m-0 hidden overflow-y-hidden transition-all transition-duration-400 transition-ease-in-out">
                        <li *ngFor="let child of item.children">
                           <a pRipple (click)="onMenuClick(child)" *ngIf="hasPermission(child)"
                              class="flex align-items-center cursor-pointer p-3 border-round text-600 hover:surface-100 transition-duration-150 transition-colors w-full">
                              <i [class]="getIconName(child.icon) + ' mr-3 text-lg'"></i>
                              <span class="font-medium">{{ child.label }}</span>
                           </a>
                        </li>
                     </ul>
                  </li>

                  <!-- Item without children -->
                  <li *ngIf="!item.children || item.children.length === 0" class="mb-1">
                     <a pRipple (click)="onMenuClick(item)"
                        class="flex align-items-center cursor-pointer p-3 border-round text-700 hover:surface-100 transition-duration-150 transition-colors w-full">
                        <i [class]="getIconName(item.icon) + ' mr-3 text-lg'"></i>
                        <span class="font-medium">{{ item.label }}</span>
                     </a>
                  </li>

               </ng-container>
            </ng-container>
         </ul>

         <div class="mt-auto border-top-1 surface-border pt-3">
            <a pRipple (click)="logout()"
               class="flex align-items-center cursor-pointer p-3 border-round text-700 hover:surface-100 hover:text-red-500 transition-duration-150 transition-colors w-full">
               <i class="pi pi-power-off mr-3 text-lg"></i>
               <span class="font-medium">Cerrar Sesión</span>
            </a>
         </div>
      </div>
   </p-drawer>

   <!-- Main Content -->
   <div class="layout-main flex-grow-1 p-4 w-full" style="margin-top: 4rem;">
      <router-outlet></router-outlet>
   </div>
</div>