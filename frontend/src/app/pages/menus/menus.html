<div class="flex flex-column gap-4 p-4 fadein animation-duration-300">
    <app-page-header title="Gestión de Menú" subtitle="Administración de la estructura de navegación" icon="pi pi-list">
        <p-button label="Nuevo Ítem" icon="pi pi-plus" (onClick)="openNew()"></p-button>
        <p-button icon="pi pi-refresh" [text]="true" [rounded]="true" (onClick)="loadMenuItems()"></p-button>
    </app-page-header>
    <p-toast></p-toast>
    <div class="card p-4 surface-card border-round shadow-2 overflow-x-auto">
        <p-treeTable [value]="menuItems()" [loading]="loading()" styleClass="p-treetable-sm"
            [tableStyle]="{'min-width': '50rem'}">
            <ng-template pTemplate="header">
                <tr>
                    <th>Etiqueta</th>
                    <th>Icono</th>
                    <th>Ruta</th>
                    <th>Permiso</th>
                    <th>Orden</th>
                    <th>Activo</th>
                    <th>Acciones</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowNode let-rowData="rowData">
                <tr [ttRow]="rowNode">
                    <td>
                        <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>
                        {{ rowData.label }}
                    </td>
                    <td>
                        <i [class]="'pi ' + rowData.icon" *ngIf="rowData.icon"></i>
                        <span *ngIf="rowData.icon" class="ml-2 text-sm text-500">{{ rowData.icon }}</span>
                    </td>
                    <td><span class="text-sm font-mono surface-100 p-1 border-round" *ngIf="rowData.route">{{
                            rowData.route }}</span></td>
                    <td>
                        <span class="text-sm surface-100 p-1 border-round" *ngIf="rowData.permissionId">
                            {{ getPermissionName(rowData.permissionId) }}
                        </span>
                    </td>
                    <td>{{ rowData.displayOrder }}</td>
                    <td>
                        <i class="pi"
                            [ngClass]="{'pi-check-circle text-green-500': rowData.isActive, 'pi-times-circle text-red-500': !rowData.isActive}"></i>
                    </td>
                    <td>
                        <div class="flex gap-2">
                            <p-button icon="pi pi-pencil" [text]="true" [rounded]="true" severity="info"
                                (onClick)="editItem(rowData)"></p-button>
                            <p-button icon="pi pi-trash" [text]="true" [rounded]="true" severity="danger"
                                (onClick)="deleteItem(rowData)"></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="6" class="text-center p-4">No hay ítems de menú definidos.</td>
                </tr>
            </ng-template>
        </p-treeTable>
    </div>

    <app-menu-dialog [visible]="dialogVisible()" (visibleChange)="dialogVisible.set($event)" [item]="editingItem()"
        [parentOptions]="parentOptions()" [permissionOptions]="permissionOptions()" [saving]="saving()"
        (save)="saveItem($event)">
    </app-menu-dialog>
</div>