<div class="flex flex-column gap-2 p-fluid p-4">
    <form [formGroup]="form" class="flex flex-column gap-2">
        <div>
            <p-floatlabel variant="in">
                <input pInputText id="name" formControlName="name" class="w-full" autocomplete="off" />
                <label for="name">Nombre de la solicitud</label>
            </p-floatlabel>
            <small class="p-error" *ngIf="form.get('name')?.invalid && form.get('name')?.dirty">
                Nombre es requerido
            </small>
        </div>

        <div class="formgrid grid">
            <div class="col-12 md:col-6 mb-2">
                <p-floatlabel variant="in">
                    <input pInputText id="department" formControlName="department" class="w-full" autocomplete="off" />
                    <label for="department">Departamento</label>
                </p-floatlabel>
                <small class="p-error" *ngIf="form.get('department')?.invalid && form.get('department')?.dirty">
                    Departamento es requerido
                </small>
            </div>
            <div class="col-12 md:col-6 mb-2">
                <p-floatlabel variant="in">
                    <input pInputText id="contactPerson" formControlName="contactPerson" class="w-full"
                        autocomplete="off" />
                    <label for="contactPerson">Persona de contacto</label>
                </p-floatlabel>
                <small class="p-error" *ngIf="form.get('contactPerson')?.invalid && form.get('contactPerson')?.dirty">
                    Contacto es requerido
                </small>
            </div>
        </div>

        <div class="formgrid grid">
            <div class="col-12 md:col-6 mb-2">
                <p-floatlabel variant="in">
                    <input pInputText id="assignedTeam" formControlName="assignedTeam" class="w-full"
                        autocomplete="off" />
                    <label for="assignedTeam">Equipo asignado</label>
                </p-floatlabel>
                <small class="p-error" *ngIf="form.get('assignedTeam')?.invalid && form.get('assignedTeam')?.dirty">
                    Equipo es requerido
                </small>
            </div>
            <div class="col-12 md:col-6 mb-2">
                <p-floatlabel variant="in">
                    <p-datepicker id="deliveryDate" formControlName="deliveryDate" dateFormat="yy-mm-dd"
                        [showIcon]="true" appendTo="body" styleClass="w-full" inputStyleClass="w-full"></p-datepicker>
                    <label for="deliveryDate">Fecha de entrega</label>
                </p-floatlabel>
                <small class="p-error" *ngIf="form.get('deliveryDate')?.invalid && form.get('deliveryDate')?.dirty">
                    Fecha es requerida
                </small>
            </div>
        </div>

        <div>
            <p-floatlabel variant="in">
                <textarea pTextarea id="observations" formControlName="observations" rows="3" autoResize="autoResize"
                    class="w-full"></textarea>
                <label for="observations">Observaciones</label>
            </p-floatlabel>
        </div>

        <div>
            <label class="font-bold mb-2 block">Archivos adjuntos</label>

            <p-fileUpload mode="advanced" name="demo[]" [customUpload]="true" (uploadHandler)="onUpload($event)"
                [multiple]="true" accept="image/*,application/pdf,.doc,.docx,.xls,.xlsx" [maxFileSize]="10000000"
                chooseLabel="Seleccionar" uploadLabel="Subir" cancelLabel="Cancelar">
            </p-fileUpload>

            <div *ngIf="existingFiles.length > 0 || uploadedFiles.length > 0" class="mt-3">
                <div *ngFor="let file of existingFiles"
                    class="flex align-items-center justify-content-between p-2 surface-hover border-round mb-2">
                    <div class="flex align-items-center gap-2">
                        <i class="pi pi-file text-primary"></i>
                        <span class="text-sm">{{file.name}}</span>
                    </div>
                    <button pButton icon="pi pi-times"
                        class="p-button-text p-button-danger p-button-sm p-0 w-2rem h-2rem"
                        (click)="removeFile(file)"></button>
                </div>
                <div *ngFor="let file of uploadedFiles"
                    class="flex align-items-center justify-content-between p-2 surface-hover border-round mb-2">
                    <div class="flex align-items-center gap-2">
                        <i class="pi pi-file text-green-500"></i>
                        <span class="text-sm">{{file.name}} (Nuevo)</span>
                    </div>
                    <button pButton icon="pi pi-times"
                        class="p-button-text p-button-danger p-button-sm p-0 w-2rem h-2rem"
                        (click)="removeFile(file)"></button>
                </div>
            </div>
        </div>
    </form>

    <div class="flex justify-content-end gap-2 mt-4">
        <button pButton label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="cancel()"></button>
        <button pButton label="Guardar" icon="pi pi-check" (click)="save()" [loading]="isUploading"></button>
    </div>
</div>