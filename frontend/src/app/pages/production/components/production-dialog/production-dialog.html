<div class="flex flex-column gap-4 p-fluid">
    <form [formGroup]="form" class="flex flex-column gap-3">
        <div class="field">
            <label for="name" class="font-bold">Nombre de la solicitud</label>
            <input pInputText id="name" formControlName="name" placeholder="Ej. Campaña Publicitaria Q3" />
            <small class="p-error" *ngIf="form.get('name')?.invalid && form.get('name')?.dirty">
                Nombre es requerido
            </small>
        </div>

        <div class="formgrid grid">
            <div class="field col-12 md:col-6">
                <label for="department" class="font-bold">Departamento</label>
                <input pInputText id="department" formControlName="department" placeholder="Ej. Marketing" />
                <small class="p-error" *ngIf="form.get('department')?.invalid && form.get('department')?.dirty">
                    Departamento es requerido
                </small>
            </div>
            <div class="field col-12 md:col-6">
                <label for="contactPerson" class="font-bold">Persona de contacto</label>
                <input pInputText id="contactPerson" formControlName="contactPerson" placeholder="Ej. Ana Martínez" />
                <small class="p-error" *ngIf="form.get('contactPerson')?.invalid && form.get('contactPerson')?.dirty">
                    Contacto es requerido
                </small>
            </div>
        </div>

        <div class="formgrid grid">
            <div class="field col-12 md:col-6">
                <label for="assignedTeam" class="font-bold">Equipo asignado</label>
                <input pInputText id="assignedTeam" formControlName="assignedTeam"
                    placeholder="Ej. Equipo Creativo A" />
                <small class="p-error" *ngIf="form.get('assignedTeam')?.invalid && form.get('assignedTeam')?.dirty">
                    Equipo es requerido
                </small>
            </div>
            <div class="field col-12 md:col-6">
                <label for="deliveryDate" class="font-bold">Fecha de entrega</label>
                <p-datepicker id="deliveryDate" formControlName="deliveryDate" dateFormat="yy-mm-dd" [showIcon]="true"
                    appendTo="body"></p-datepicker>
                <small class="p-error" *ngIf="form.get('deliveryDate')?.invalid && form.get('deliveryDate')?.dirty">
                    Fecha es requerida
                </small>
            </div>
        </div>

        <div class="field">
            <label for="observations" class="font-bold">Observaciones</label>
            <textarea pTextarea id="observations" formControlName="observations" rows="3"
                autoResize="autoResize"></textarea>
        </div>

        <div class="field">
            <label class="font-bold mb-2 block">Archivos adjuntos</label>

            <p-fileUpload mode="advanced" name="demo[]" [customUpload]="true" (uploadHandler)="onUpload($event)"
                [multiple]="true" accept="image/*,application/pdf,.doc,.docx,.xls,.xlsx" [maxFileSize]="10000000"
                chooseLabel="Seleccionar" uploadLabel="Subir" cancelLabel="Cancelar">
            </p-fileUpload>

            <div *ngIf="existingFiles.length > 0 || uploadedFiles.length > 0" class="mt-3">
                <div *ngFor="let file of existingFiles"
                    class="flex align-items-center justify-content-between p-2 surface-hover border-round mb-2">
                    <div class="flex align-items-center gap-2">
                        <i class="pi pi-file text-primary"></i>
                        <span class="text-sm">{{file.name}}</span>
                    </div>
                    <button pButton icon="pi pi-times"
                        class="p-button-text p-button-danger p-button-sm p-0 w-2rem h-2rem"
                        (click)="removeFile(file)"></button>
                </div>
                <div *ngFor="let file of uploadedFiles"
                    class="flex align-items-center justify-content-between p-2 surface-hover border-round mb-2">
                    <div class="flex align-items-center gap-2">
                        <i class="pi pi-file text-green-500"></i>
                        <span class="text-sm">{{file.name}} (Nuevo)</span>
                    </div>
                    <button pButton icon="pi pi-times"
                        class="p-button-text p-button-danger p-button-sm p-0 w-2rem h-2rem"
                        (click)="removeFile(file)"></button>
                </div>
            </div>
        </div>
    </form>

    <div class="flex justify-content-end gap-2 mt-4">
        <button pButton label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="cancel()"></button>
        <button pButton label="Guardar" icon="pi pi-check" (click)="save()" [loading]="isUploading"></button>
    </div>
</div>